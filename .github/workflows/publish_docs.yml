name: ğŸ“˜ Generar y Publicar DocumentaciÃ³n en GitHub Pages

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ”„ Checkout del cÃ³digo
      uses: actions/checkout@v4

    - name: ğŸ§° Setup .NET SDK
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '8.0.x'

    - name: ğŸ“¦ Instalar DocFX
      run: dotnet tool install --global docfx

    - name: ğŸ—ï¸ Generar metadata y construir documentaciÃ³n
      run: |
        cd docs
        docfx metadata
        docfx build

    - name: âš™ï¸ Configurar Git para despliegue
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "github-actions@github.com"

    - name: ğŸš€ Desplegar en GitHub Pages (gh-pages)
      run: |
        mkdir gh-pages-temp
        cp -r docs/_site/* gh-pages-temp/

        git fetch origin
        git checkout --orphan gh-pages
        git reset
        rm -rf *

        mv gh-pages-temp/* .
        rm -rf gh-pages-temp

        touch .nojekyll
        git add .
        git commit -m "ğŸš€ Publicar documentaciÃ³n DocFX"
        git push origin gh-pages --force
